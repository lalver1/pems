name: Deploy Troubleshoot

on: workflow_dispatch

permissions:
  contents: read

defaults:
  run:
    shell: bash

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ github.ref_type != 'tag' && 'dev' || contains(github.ref, '-rc') && 'test' || 'prod' }}
    permissions:
      packages: write
      id-token: write
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version-file: .github/workflows/.python-version
          cache: pip
          cache-dependency-path: "**/pyproject.toml"

      - name: Troubleshoot env
        run: |
          echo "Ref type"
          echo ${{ github.ref_type }}
          echo "Environment"
          echo ${{ vars.NAME }}

      - name: Dump GitHub context
        id: github_context_step
        run: echo '${{ toJSON(github) }}'

      - name: Dump Job context
        id: job_context_step
        run: echo '${{ toJSON(job) }}'
